# Maintainer: matik <wierzejskimateusz8@gmail.com>
pkgname=xlibre-video-omap
pkgver="25.0.0"
pkgrel=0
pkgdesc="OMAP3+ framebuffer driver for Xlibre"
url="https://github.com/X11Libre/xf86-video-omap"
arch="armv7"
license="GPL-2.0-only"
makedepends="xlibre-xserver-dev libxi-dev util-macros xorgproto libdrm-dev m4
	autoconf automake libtool libc-dev eudev-dev" #libudev-zero-dev additionally workssubpackages="$pkgname-doc"
source="https://github.com/X11Libre/xf86-video-omap/archive/refs/tags/xlibre-xf86-video-omap-$pkgver.tar.gz"
options="!check" #no check
subpackages="$pkgname-doc"
builddir="$srcdir/xf86-video-omap-xlibre-xf86-video-omap-$pkgver"
provides="xf86-video-omap=$pkgver-r$pkgrel"
replaces="xf86-video-omap"

prepare() {
	default_prepare
	autoreconf -fi
}

build() {
	export CFLAGS="${CFLAGS/-fno-plt}"
	export CXXFLAGS="${CXXFLAGS/-fno-plt}"
	export LDFLAGS="$LDFLAGS -Wl,-z,lazy"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr
	make
}

check() {
	make check || true
}

package() {
	make DESTDIR="$pkgdir" install
}

sha512sums="
89fbfd798c052366cbe6f85dc7fb80c346d294897ca1d88f7d7820bc18e5a76ed218e64a5ddf9d25baf55aad8a265b82ced58a05540e25fdf5a8c2dac8a4605b  xlibre-xf86-video-omap-25.0.0.tar.gz
"
